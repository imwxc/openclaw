# é£ä¹¦é•¿è½®è¯¢åŠŸèƒ½å®ç°ä»»åŠ¡æ¸…å•

> **é¡¹ç›®**: OpenClaw Feishu æ‰©å±• - é•¿è½®è¯¢åŠŸèƒ½  
> **åˆ›å»ºæ—¥æœŸ**: 2026-02-24  
> **ç‰ˆæœ¬**: 1.0

---

## ğŸ“‹ ä»»åŠ¡æ€»è§ˆ

| é˜¶æ®µ | ä»»åŠ¡æ•° | é¢„è®¡å·¥ä½œé‡ | çŠ¶æ€ |
|-----|-------|-----------|------|
| 1. åŸºç¡€è®¾æ–½ | 4 | 2 å¤© | ğŸ”µ æœªå¼€å§‹ |
| 2. æ ¸å¿ƒå®ç° | 6 | 5 å¤© | ğŸ”µ æœªå¼€å§‹ |
| 3. æµ‹è¯•å®ç° | 5 | 4 å¤© | ğŸ”µ æœªå¼€å§‹ |
| 4. é›†æˆä¸æ–‡æ¡£ | 4 | 2 å¤© | ğŸ”µ æœªå¼€å§‹ |
| **æ€»è®¡** | **19** | **13 å¤©** | - |

---

## é˜¶æ®µ 1: åŸºç¡€è®¾æ–½

### ä»»åŠ¡ 1.1: é…ç½® Schema æ›´æ–°
**ä¼˜å…ˆçº§**: P0  
**ä¾èµ–**: æ—   
**é¢„è®¡è€—æ—¶**: 4 å°æ—¶

- [ ] åœ¨ `config-schema.ts` ä¸­æ·»åŠ  `FeishuPollingConfigSchema`
- [ ] æ›´æ–° `FeishuConnectionModeSchema` æ·»åŠ  `"polling"` é€‰é¡¹
- [ ] åœ¨ `FeishuSharedConfigShape` ä¸­æ·»åŠ  `polling` é…ç½®é¡¹
- [ ] æ›´æ–°é…ç½®éªŒè¯é€»è¾‘
- [ ] æ·»åŠ é…ç½®ç±»å‹å¯¼å‡º

**éªŒæ”¶æ ‡å‡†**:
- [ ] é…ç½®éªŒè¯é€šè¿‡æ‰€æœ‰ç°æœ‰æµ‹è¯•
- [ ] æ–°é…ç½®ç±»å‹æ­£ç¡®å¯¼å‡º
- [ ] é…ç½®ç¤ºä¾‹å¯æ­£å¸¸è§£æ

```typescript
// æ–°å¢é…ç½®ç¤ºä¾‹
{
  "connectionMode": "polling",
  "polling": {
    "longPollingTimeout": 30,
    "batchSize": 100,
    "retryPolicy": { ... }
  }
}
```

---

### ä»»åŠ¡ 1.2: ç±»å‹å®šä¹‰
**ä¼˜å…ˆçº§**: P0  
**ä¾èµ–**: æ—   
**é¢„è®¡è€—æ—¶**: 2 å°æ—¶

- [ ] åœ¨ `types.ts` ä¸­æ·»åŠ è½®è¯¢ç›¸å…³ç±»å‹ï¼š
  - `PollingState`
  - `PollingOptions`
  - `PollingError`
  - `PollingErrorType`
  - `EventHandler`
  - `ErrorHandler`
- [ ] æ›´æ–° `ResolvedFeishuAccount` ç±»å‹æ·»åŠ  `polling` é…ç½®
- [ ] å¯¼å‡ºæ‰€æœ‰æ–°ç±»å‹

**éªŒæ”¶æ ‡å‡†**:
- [ ] æ‰€æœ‰ç±»å‹æœ‰å®Œæ•´çš„ JSDoc æ³¨é‡Š
- [ ] ç±»å‹ç¼–è¯‘æ— é”™è¯¯

---

### ä»»åŠ¡ 1.3: æ¸¸æ ‡å­˜å‚¨å®ç°
**ä¼˜å…ˆçº§**: P0  
**ä¾èµ–**: æ—   
**é¢„è®¡è€—æ—¶**: 1 å¤©

- [ ] åˆ›å»º `src/polling-offset-store.ts`
- [ ] å®ç° `PollingOffsetStore` æ¥å£ï¼š
  - `readCursor(accountId)`
  - `writeCursor(accountId, cursor)`
  - `deleteCursor(accountId)`
- [ ] å®ç° `FilePollingOffsetStore` ç±»
- [ ] æ·»åŠ æ–‡ä»¶æ ¼å¼ç‰ˆæœ¬æ§åˆ¶ï¼ˆversion: 1ï¼‰
- [ ] å®ç°å¹¶å‘å†™å…¥ä¿æŠ¤ï¼ˆåŸå­å†™å…¥ï¼‰
- [ ] æ·»åŠ é”™è¯¯å¤„ç†ï¼ˆç£ç›˜æ»¡ã€æƒé™é”™è¯¯ç­‰ï¼‰

**æ–‡ä»¶æ ¼å¼**:
```json
{
  "version": 1,
  "cursor": "base64_encoded_cursor",
  "lastEventTime": "2026-02-24T12:00:00Z",
  "accountId": "default"
}
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] æ‰€æœ‰å•å…ƒæµ‹è¯•é€šè¿‡ï¼ˆè§æµ‹è¯•è®¡åˆ’ 2.2 èŠ‚ï¼‰
- [ ] å¹¶å‘å†™å…¥æµ‹è¯•é€šè¿‡
- [ ] ç£ç›˜é”™è¯¯å¤„ç†æµ‹è¯•é€šè¿‡

---

### ä»»åŠ¡ 1.4: é€€é¿ç­–ç•¥å·¥å…·
**ä¼˜å…ˆçº§**: P1  
**ä¾èµ–**: æ—   
**é¢„è®¡è€—æ—¶**: 4 å°æ—¶

- [ ] åˆ›å»º `src/polling-backoff.ts`
- [ ] å®ç°æŒ‡æ•°é€€é¿ç®—æ³•ï¼š
  ```typescript
  export function computeBackoff(
    attempt: number,
    config: BackoffConfig
  ): number;
  ```
- [ ] å®ç°æŠ–åŠ¨ç®—æ³•ï¼ˆå¯é€‰ jitterï¼‰
- [ ] å‚è€ƒ `src/infra/backoff.ts` ä¿æŒä¸€è‡´æ€§
- [ ] æ·»åŠ å•å…ƒæµ‹è¯•

**éªŒæ”¶æ ‡å‡†**:
- [ ] é€€é¿æ—¶é—´è®¡ç®—æ­£ç¡®
- [ ] æœ€å¤§é€€é¿æ—¶é—´ä¸Šé™ç”Ÿæ•ˆ
- [ ] æŠ–åŠ¨åŠŸèƒ½æ­£å¸¸å·¥ä½œ

---

## é˜¶æ®µ 2: æ ¸å¿ƒå®ç°

### ä»»åŠ¡ 2.1: Polling Client æ¥å£å®šä¹‰
**ä¼˜å…ˆçº§**: P0  
**ä¾èµ–**: 1.2 (ç±»å‹å®šä¹‰)  
**é¢„è®¡è€—æ—¶**: 2 å°æ—¶

- [ ] åˆ›å»º `src/polling-client.ts`
- [ ] å®šä¹‰ `FeishuPollingClient` æ¥å£ï¼š
  ```typescript
  export interface FeishuPollingClient {
    start(): Promise<void>;
    stop(): Promise<void>;
    pause(): void;
    resume(): void;
    readonly state: PollingState;
    onEvent(callback: EventHandler): void;
    onError(callback: ErrorHandler): void;
  }
  ```
- [ ] å¯¼å‡ºæ¥å£å’Œç±»å‹

---

### ä»»åŠ¡ 2.2: Polling Client æ ¸å¿ƒå®ç°
**ä¼˜å…ˆçº§**: P0  
**ä¾èµ–**: 1.3, 1.4, 2.1  
**é¢„è®¡è€—æ—¶**: 2 å¤©

- [ ] å®ç° `FeishuPollingClientImpl` ç±»
- [ ] å®ç°çŠ¶æ€æœºï¼š
  - `idle` â†’ `connecting` â†’ `polling` â†’ `stopped`
  - æ”¯æŒ `paused` ä¸­é—´çŠ¶æ€
- [ ] å®ç° `runPollingLoop` æ–¹æ³•ï¼š
  - å¾ªç¯è·å–äº‹ä»¶
  - å¤„ç†ä¸­æ–­ä¿¡å·
  - é”™è¯¯é‡è¯•é€»è¾‘
- [ ] å®ç° `pollOnce` æ–¹æ³•ï¼š
  - è°ƒç”¨é£ä¹¦ API
  - å¤„ç†è¶…æ—¶
  - è§£æå“åº”
- [ ] å®ç°äº‹ä»¶å¤„ç†ï¼š`processEvents`
- [ ] å®ç°æ¸¸æ ‡ç®¡ç†ï¼š
  - å¯åŠ¨æ—¶æ¢å¤æ¸¸æ ‡
  - å¤„ç†åä¿å­˜æ¸¸æ ‡
- [ ] å®ç°é”™è¯¯åˆ†ç±»ä¸å¤„ç†
- [ ] å®ç°ä¼˜é›…å…³é—­é€»è¾‘

**å…³é”®ä»£ç ç»“æ„**:
```typescript
export class FeishuPollingClientImpl implements FeishuPollingClient {
  private state: PollingState = 'idle';
  private abortController: AbortController | null = null;
  private eventHandlers: EventHandler[] = [];
  private errorHandlers: ErrorHandler[] = [];
  private offsetStore: PollingOffsetStore;
  
  constructor(
    private account: ResolvedFeishuAccount,
    private eventDispatcher: Lark.EventDispatcher,
    private options: PollingOptions
  ) {
    this.offsetStore = new FilePollingOffsetStore();
  }
  
  async start(): Promise<void> { ... }
  async stop(): Promise<void> { ... }
  private async runPollingLoop(cursor: string | null): Promise<void> { ... }
  private async pollOnce(cursor: string | null): Promise<PollResult> { ... }
  private async processEvents(events: FeishuEvent[]): Promise<void> { ... }
  private handlePollingError(error: unknown): Promise<void> { ... }
}
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] çŠ¶æ€æœºè½¬æ¢æ­£ç¡®
- [ ] å¯ä»¥æˆåŠŸè·å–å’Œå¤„ç†äº‹ä»¶
- [ ] é”™è¯¯æ—¶æ­£ç¡®é‡è¯•
- [ ] å¯ä»¥ä¼˜é›…å…³é—­

---

### ä»»åŠ¡ 2.3: é£ä¹¦ API é›†æˆ
**ä¼˜å…ˆçº§**: P0  
**ä¾èµ–**: 2.2  
**é¢„è®¡è€—æ—¶**: 1 å¤©

- [ ] ç¡®è®¤é£ä¹¦ SDK äº‹ä»¶åˆ—è¡¨ API
- [ ] å®ç° API è°ƒç”¨å°è£…
- [ ] å¤„ç† API å“åº”è§£æ
- [ ] å®ç°é”™è¯¯ç æ˜ å°„ï¼š
  - ç½‘ç»œé”™è¯¯ â†’ `NETWORK_ERROR`
  - 401/403 â†’ `AUTH_ERROR`
  - 429 â†’ `RATE_LIMIT`
  - 5xx â†’ `SERVER_ERROR`
  - å…¶ä»– â†’ `CLIENT_ERROR`
- [ ] æ·»åŠ è¯·æ±‚è¶…æ—¶å¤„ç†
- [ ] æµ‹è¯•ä¸çœŸå®é£ä¹¦ API çš„é›†æˆ

**API è°ƒç”¨ç¤ºä¾‹**:
```typescript
const response = await client.im.v1.events.list({
  query: {
    cursor,
    limit: options.batchSize,
    timeout: options.longPollingTimeout,
  },
}, {
  signal: abortController.signal,
});
```

---

### ä»»åŠ¡ 2.4: Monitor é›†æˆ
**ä¼˜å…ˆçº§**: P0  
**ä¾èµ–**: 2.2  
**é¢„è®¡è€—æ—¶**: 1 å¤©

- [ ] ä¿®æ”¹ `monitor.ts` æ·»åŠ  polling æ¨¡å¼æ”¯æŒ
- [ ] å®ç° `monitorPolling` å‡½æ•°
- [ ] åœ¨ `monitorSingleAccount` ä¸­æ·»åŠ  polling åˆ†æ”¯
- [ ] ç®¡ç† polling client ç”Ÿå‘½å‘¨æœŸ
- [ ] å®ç°æ¸…ç†é€»è¾‘ï¼ˆ`stopFeishuMonitor`ï¼‰
- [ ] æ·»åŠ æ—¥å¿—è¾“å‡º

**ä»£ç ä¿®æ”¹**:
```typescript
// monitor.ts
async function monitorPolling({
  params,
  accountId,
  eventDispatcher,
}: ConnectionParams): Promise<void> {
  const { account, runtime, abortSignal } = params;
  const client = new FeishuPollingClientImpl(
    account,
    eventDispatcher,
    account.config.polling
  );
  
  pollingClients.set(accountId, client);
  
  return new Promise((resolve, reject) => {
    // å®ç°å¯åŠ¨ã€åœæ­¢ã€é”™è¯¯å¤„ç†é€»è¾‘
  });
}
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] polling æ¨¡å¼å¯ä»¥æ­£å¸¸å¯åŠ¨
- [ ] äº‹ä»¶æ­£ç¡®åˆ†å‘åˆ° handler
- [ ] åœæ­¢æ—¶èµ„æºæ­£ç¡®æ¸…ç†

---

### ä»»åŠ¡ 2.5: é…ç½®é»˜è®¤å€¼å¤„ç†
**ä¼˜å…ˆçº§**: P1  
**ä¾èµ–**: 1.1  
**é¢„è®¡è€—æ—¶**: 4 å°æ—¶

- [ ] å®ç° `mergeWithDefaults` å‡½æ•°
- [ ] å®šä¹‰é»˜è®¤é…ç½®ï¼š
  ```typescript
  const DEFAULT_POLLING_OPTIONS: Required<PollingOptions> = {
    pollIntervalMs: 1000,
    longPollingTimeout: 30,
    batchSize: 100,
    retryPolicy: {
      initialDelayMs: 1000,
      maxDelayMs: 30000,
      factor: 2,
      jitter: 0.1,
      maxRetries: null,
    },
    autoResume: true,
  };
  ```
- [ ] ç¡®ä¿éƒ¨åˆ†é…ç½®å¯ä»¥è¦†ç›–é»˜è®¤å€¼
- [ ] æ·»åŠ é…ç½®éªŒè¯

---

### ä»»åŠ¡ 2.6: æ—¥å¿—ä¸ç›‘æ§
**ä¼˜å…ˆçº§**: P1  
**ä¾èµ–**: 2.2  
**é¢„è®¡è€—æ—¶**: 4 å°æ—¶

- [ ] æ·»åŠ è½®è¯¢çŠ¶æ€æ—¥å¿—
- [ ] æ·»åŠ äº‹ä»¶å¤„ç†æ—¥å¿—ï¼ˆDEBUG çº§åˆ«ï¼‰
- [ ] æ·»åŠ é”™è¯¯æ—¥å¿—
- [ ] å®ç°è½®è¯¢ç»Ÿè®¡ï¼š
  - è¯·æ±‚æ¬¡æ•°
  - äº‹ä»¶æ•°é‡
  - é”™è¯¯æ¬¡æ•°
  - å¹³å‡å»¶è¿Ÿ
- [ ] æš´éœ²å¥åº·æ£€æŸ¥æ¥å£

**æ—¥å¿—ç¤ºä¾‹**:
```
[feishu:default] Polling client starting...
[feishu:default] Connection state: connecting -> polling
[feishu:default] Polled 5 events, next cursor: xxx
[feishu:default] Network error, retrying in 2000ms (attempt 1/3)
```

---

## é˜¶æ®µ 3: æµ‹è¯•å®ç°

### ä»»åŠ¡ 3.1: Polling Client å•å…ƒæµ‹è¯•
**ä¼˜å…ˆçº§**: P0  
**ä¾èµ–**: 2.2  
**é¢„è®¡è€—æ—¶**: 1.5 å¤©

- [ ] åˆ›å»º `src/polling-client.test.ts`
- [ ] å®ç°ç”Ÿå‘½å‘¨æœŸæµ‹è¯•ï¼š
  - `idle` â†’ `connecting` â†’ `polling` â†’ `stopped`
  - çŠ¶æ€è½¬æ¢è¾¹ç•Œ
- [ ] å®ç°äº‹ä»¶å¤„ç†æµ‹è¯•
- [ ] å®ç°æ‰¹é‡å¤„ç†æµ‹è¯•
- [ ] å®ç°æ¸¸æ ‡ç®¡ç†æµ‹è¯•
- [ ] å®ç°é”™è¯¯å¤„ç†æµ‹è¯•
- [ ] å®ç°é…ç½®éªŒè¯æµ‹è¯•
- [ ] å®ç° Mock å·¥å…·ï¼š`createTestClient`

**æµ‹è¯•è¦†ç›–ç›®æ ‡**:
- è¡Œè¦†ç›–ç‡ >= 90%
- åˆ†æ”¯è¦†ç›–ç‡ >= 85%

---

### ä»»åŠ¡ 3.2: Offset Store å•å…ƒæµ‹è¯•
**ä¼˜å…ˆçº§**: P0  
**ä¾èµ–**: 1.3  
**é¢„è®¡è€—æ—¶**: 1 å¤©

- [ ] åˆ›å»º `src/polling-offset-store.test.ts`
- [ ] å®ç°è¯»å†™æµ‹è¯•
- [ ] å®ç°å¤šè´¦æˆ·éš”ç¦»æµ‹è¯•
- [ ] å®ç°æ–‡ä»¶æ ¼å¼æµ‹è¯•
- [ ] å®ç°å¹¶å‘å®‰å…¨æµ‹è¯•
- [ ] å®ç°é”™è¯¯å¤„ç†æµ‹è¯•
- [ ] å®ç°ç‰ˆæœ¬å…¼å®¹æ€§æµ‹è¯•

---

### ä»»åŠ¡ 3.3: Mock æœåŠ¡å™¨å®ç°
**ä¼˜å…ˆçº§**: P1  
**ä¾èµ–**: æ—   
**é¢„è®¡è€—æ—¶**: 1 å¤©

- [ ] åˆ›å»º `src/test/mock-feishu-server.ts`
- [ ] å®ç° HTTP æœåŠ¡å™¨æ¨¡æ‹Ÿ
- [ ] å®ç°äº‹ä»¶é˜Ÿåˆ—ç®¡ç†
- [ ] å®ç°é”™è¯¯æ¨¡æ‹Ÿï¼š
  - æŒ‡å®šæ¬¡æ•°å¤±è´¥
  - å…¨éƒ¨å¤±è´¥
  - å»¶è¿Ÿå“åº”
- [ ] å®ç°ç»Ÿè®¡ä¿¡æ¯æ”¶é›†
- [ ] å®ç°è¯·æ±‚ä¸­æ­¢æ£€æµ‹

---

### ä»»åŠ¡ 3.4: é›†æˆæµ‹è¯•
**ä¼˜å…ˆçº§**: P1  
**ä¾èµ–**: 2.4, 3.3  
**é¢„è®¡è€—æ—¶**: 1 å¤©

- [ ] åˆ›å»º `src/polling.integration.test.ts`
- [ ] å®ç°é•¿è½®è¯¢è¡Œä¸ºæµ‹è¯•
- [ ] å®ç°äº‹ä»¶å¤„ç†æµ‹è¯•
- [ ] å®ç°é”™è¯¯æ¢å¤æµ‹è¯•
- [ ] å®ç°èµ„æºæ¸…ç†æµ‹è¯•
- [ ] å®ç°å¤šè´¦æˆ·å¹¶å‘æµ‹è¯•

---

### ä»»åŠ¡ 3.5: E2E æµ‹è¯•å‡†å¤‡
**ä¼˜å…ˆçº§**: P2  
**ä¾èµ–**: 2.4  
**é¢„è®¡è€—æ—¶**: 4 å°æ—¶

- [ ] åˆ›å»º `src/polling.e2e.test.ts`
- [ ] å®ç°çœŸå®é£ä¹¦åº”ç”¨æµ‹è¯•æ¡†æ¶
- [ ] é…ç½® CI ç¯å¢ƒå˜é‡
- [ ] å®ç°åŸºç¡€ E2E æµ‹è¯•ç”¨ä¾‹

---

## é˜¶æ®µ 4: é›†æˆä¸æ–‡æ¡£

### ä»»åŠ¡ 4.1: æ–‡æ¡£æ›´æ–°
**ä¼˜å…ˆçº§**: P1  
**ä¾èµ–**: å…¨éƒ¨å®ç°ä»»åŠ¡  
**é¢„è®¡è€—æ—¶**: 1 å¤©

- [ ] æ›´æ–° `README.md` æ·»åŠ  polling æ¨¡å¼è¯´æ˜
- [ ] åˆ›å»º `docs/polling.md` ä½¿ç”¨æŒ‡å—
- [ ] æ›´æ–°é…ç½®æ–‡æ¡£
- [ ] æ·»åŠ è¿ç§»æŒ‡å—ï¼ˆWebSocket â†’ Pollingï¼‰
- [ ] æ·»åŠ æ•…éšœæ’æŸ¥æŒ‡å—

**æ–‡æ¡£ç»“æ„**:
```
docs/
â”œâ”€â”€ rfc-polling.md          # å·²å®ç°
â”œâ”€â”€ polling-test-plan.md    # å·²å®ç°
â”œâ”€â”€ polling.md              # ä½¿ç”¨æŒ‡å—ï¼ˆæ–°å¢ï¼‰
â””â”€â”€ migration-guide.md      # è¿ç§»æŒ‡å—ï¼ˆæ–°å¢ï¼‰
```

---

### ä»»åŠ¡ 4.2: ç¤ºä¾‹é…ç½®
**ä¼˜å…ˆçº§**: P1  
**ä¾èµ–**: 1.1  
**é¢„è®¡è€—æ—¶**: 2 å°æ—¶

- [ ] åˆ›å»º `examples/polling-config.json`
- [ ] åˆ›å»º `examples/polling-minimal.json`
- [ ] æ·»åŠ é…ç½®æ³¨é‡Šè¯´æ˜

---

### ä»»åŠ¡ 4.3: CI/CD é›†æˆ
**ä¼˜å…ˆçº§**: P1  
**ä¾èµ–**: 3.1, 3.2  
**é¢„è®¡è€—æ—¶**: 4 å°æ—¶

- [ ] æ›´æ–° GitHub Actions workflow
- [ ] æ·»åŠ  polling æµ‹è¯•ä»»åŠ¡
- [ ] é…ç½®æµ‹è¯•è¦†ç›–ç‡æ”¶é›†
- [ ] æ·»åŠ æ€§èƒ½åŸºå‡†æµ‹è¯•

---

### ä»»åŠ¡ 4.4: æœ€ç»ˆéªŒè¯
**ä¼˜å…ˆçº§**: P0  
**ä¾èµ–**: å…¨éƒ¨ä»»åŠ¡  
**é¢„è®¡è€—æ—¶**: 1 å¤©

- [ ] å®Œæ•´åŠŸèƒ½æµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•
- [ ] æ–‡æ¡£å®¡æŸ¥
- [ ] ä»£ç å®¡æŸ¥
- [ ] å‘å¸ƒå‡†å¤‡æ£€æŸ¥æ¸…å•

---

## ğŸ“Š ä¾èµ–å…³ç³»å›¾

```
1.1 é…ç½® Schema
    â”‚
    â”œâ”€â”€â–¶ 1.2 ç±»å‹å®šä¹‰
    â”‚       â”‚
    â”‚       â””â”€â”€â–¶ 2.1 Polling Client æ¥å£
    â”‚               â”‚
    â”‚               â”œâ”€â”€â–¶ 2.2 Polling Client å®ç°
    â”‚               â”‚       â”‚
    â”‚               â”‚       â”œâ”€â”€â–¶ 2.3 é£ä¹¦ API é›†æˆ
    â”‚               â”‚       â”œâ”€â”€â–¶ 2.4 Monitor é›†æˆ
    â”‚               â”‚       â””â”€â”€â–¶ 3.1 Polling Client å•å…ƒæµ‹è¯•
    â”‚               â”‚
    â”‚               â””â”€â”€â–¶ 2.5 é…ç½®é»˜è®¤å€¼å¤„ç†
    â”‚
    â”œâ”€â”€â–¶ 1.3 æ¸¸æ ‡å­˜å‚¨
    â”‚       â”‚
    â”‚       â”œâ”€â”€â–¶ 2.2 Polling Client å®ç°
    â”‚       â””â”€â”€â–¶ 3.2 Offset Store å•å…ƒæµ‹è¯•
    â”‚
    â””â”€â”€â–¶ 1.4 é€€é¿ç­–ç•¥
            â”‚
            â””â”€â”€â–¶ 2.2 Polling Client å®ç°

3.3 Mock æœåŠ¡å™¨
    â”‚
    â””â”€â”€â–¶ 3.4 é›†æˆæµ‹è¯•

å…¨éƒ¨å®ç°ä»»åŠ¡
    â”‚
    â”œâ”€â”€â–¶ 4.1 æ–‡æ¡£æ›´æ–°
    â”œâ”€â”€â–¶ 4.2 ç¤ºä¾‹é…ç½®
    â”œâ”€â”€â–¶ 4.3 CI/CD é›†æˆ
    â””â”€â”€â–¶ 4.4 æœ€ç»ˆéªŒè¯
```

---

## ğŸ“… å»ºè®®çš„è¿­ä»£è®¡åˆ’

### è¿­ä»£ 1: åŸºç¡€è®¾æ–½ (ç¬¬ 1-2 å¤©)
- 1.1 é…ç½® Schema æ›´æ–°
- 1.2 ç±»å‹å®šä¹‰
- 1.3 æ¸¸æ ‡å­˜å‚¨å®ç°

### è¿­ä»£ 2: æ ¸å¿ƒå®ç° (ç¬¬ 3-7 å¤©)
- 2.1 Polling Client æ¥å£å®šä¹‰
- 2.2 Polling Client æ ¸å¿ƒå®ç°
- 2.3 é£ä¹¦ API é›†æˆ
- 2.4 Monitor é›†æˆ

### è¿­ä»£ 3: æµ‹è¯•å®ç° (ç¬¬ 8-11 å¤©)
- 3.1 Polling Client å•å…ƒæµ‹è¯•
- 3.2 Offset Store å•å…ƒæµ‹è¯•
- 3.3 Mock æœåŠ¡å™¨å®ç°
- 3.4 é›†æˆæµ‹è¯•

### è¿­ä»£ 4: æ”¶å°¾ (ç¬¬ 12-13 å¤©)
- 4.1 æ–‡æ¡£æ›´æ–°
- 4.2 ç¤ºä¾‹é…ç½®
- 4.3 CI/CD é›†æˆ
- 4.4 æœ€ç»ˆéªŒè¯

---

## âœ… å‘å¸ƒæ£€æŸ¥æ¸…å•

- [ ] æ‰€æœ‰å•å…ƒæµ‹è¯•é€šè¿‡
- [ ] æ‰€æœ‰é›†æˆæµ‹è¯•é€šè¿‡
- [ ] ä»£ç è¦†ç›–ç‡è¾¾æ ‡
- [ ] æ–‡æ¡£å®Œæ•´
- [ ] ç¤ºä¾‹é…ç½®å¯ç”¨
- [ ] CHANGELOG æ›´æ–°
- [ ] ç‰ˆæœ¬å·æ›´æ–°
- [ ] å‘åå…¼å®¹éªŒè¯

---

## ğŸ“ å¤‡æ³¨

### é£é™©ä¸ç¼“è§£

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ |
|-----|-----|---------|
| é£ä¹¦ API ä¸æ”¯æŒé•¿è½®è¯¢ | é«˜ | æå‰éªŒè¯ API æ–‡æ¡£ï¼Œå‡†å¤‡çŸ­è½®è¯¢å¤‡é€‰æ–¹æ¡ˆ |
| æ€§èƒ½ä¸è¾¾é¢„æœŸ | ä¸­ | å®ç°å¯é…ç½®å‚æ•°ï¼Œæ”¯æŒè°ƒä¼˜ |
| ä¸ç°æœ‰ WebSocket å†²çª | ä¸­ | ç¡®ä¿æ¨¡å¼åˆ‡æ¢æ—¶èµ„æºæ­£ç¡®æ¸…ç† |

### å¾…å†³ç­–äº‹é¡¹

1. **çŸ­è½®è¯¢æ¨¡å¼**: æ˜¯å¦éœ€è¦æ”¯æŒå›ºå®šé—´éš”çš„çŸ­è½®è¯¢ï¼Ÿ
2. **å¤šè´¦æˆ·å…±äº«è¿æ¥**: å¤šä¸ªè´¦æˆ·æ˜¯å¦å…±äº« HTTP è¿æ¥æ± ï¼Ÿ
3. **äº‹ä»¶é¡ºåºä¿è¯**: æ˜¯å¦éœ€è¦ä¸¥æ ¼ä¿è¯äº‹ä»¶å¤„ç†é¡ºåºï¼Ÿ

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [å®ç°æ–¹æ¡ˆ (RFC)](./rfc-polling.md)
- [æµ‹è¯•è®¡åˆ’](./polling-test-plan.md)
- [é£ä¹¦æ‰©å±• README](../README.md)
- [Telegram é•¿è½®è¯¢å‚è€ƒ](../../src/telegram/monitor.ts)
